#!/usr/bin/env bash
#shellcheck disable=SC2155,SC2034,SC1135,SC2256
#shellcheck source=/dev/null

#  /usr/share/bigbashview/bcc/apps/big-store/header.sh.htm
#  Description: Control Center to help usage of BigLinux
#
#  Created: 2020/11/01
#  Altered: 2023/08/26
#
#  Copyright (c) 2023-2023, Vilmar Catafesta <vcatafesta@gmail.com>
#                2022-2023, Bruno Gonçalves <www.biglinux.com.br>
#                2022-2023, Rafael Ruscher <rruscher@gmail.com>
#  All rights reserved.
#
#  Redistribution and use in source and binary forms, with or without
#  modification, are permitted provided that the following conditions
#  are met:
#  1. Redistributions of source code must retain the above copyright
#     notice, this list of conditions and the following disclaimer.
#  2. Redistributions in binary form must reproduce the above copyright
#     notice, this list of conditions and the following disclaimer in the
#     documentation and/or other materials provided with the distribution.
#
#  THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
#  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
#  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
#  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
#  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
#  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
#  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
#  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
#  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

APP="${0##*/}"
_VERSION_="1.0.0-20230826"
export BOOTLOG="/tmp/bigstore-$USER-$(date +"%d%m%Y").log"
export LOGGER='/dev/tty8'
export HOME_FOLDER="$HOME/.bigstore"
export TMP_FOLDER="/tmp/bigstore-$USER"
#LIBRARY=${LIBRARY:-'/usr/share/bigbashview/bcc/shell'}
#[[ -f "${LIBRARY}/bcclib.sh"  ]] && source "${LIBRARY}/bcclib.sh"
#[[ -f "${LIBRARY}/bstrlib.sh" ]] && source "${LIBRARY}/bstrlib.sh"

function sh_config {
	#Translation
	export TEXTDOMAINDIR='/usr/share/locale'
	export TEXTDOMAIN=big-store

	declare -g ABOUT_APPSTREAM=$"
Programas nativos possuem uma integração mais robusta com o sistema operacional.<br>
Eles passam por extensos testes antes de serem disponibilizados, garantindo uma maior confiabilidade.<br>
Por essas razões, optar por um programa nativo é especialmente recomendado quando o software desejado<br>
está disponível em várias opções de instalação.<br>"

	declare -g ABOUT_AUR=$"
Programas AUR são scripts criados por usuários<br>
para instalar programas que não estão disponíveis<br>
diretamente nos repositórios nativos do sistema.<br>
Os programas instalados por esse método funcionam<br>
bem, mas não passam pelos mesmos testes feitos<br>
com os programas nativos."

	declare -g ABOUT_FLATPAK=$"
Programas Flatpak, são disponibilizados para todas as<br>
distribuições Linux, geralmente são mantidos pelos próprios<br>
criadores dos programas, porém, não possuem algumas<br>
otimizações e integrações com o sistema, como ocorre com<br>
os programas nativos, essa pode ser uma boa alternativa<br>
para quem tem computadores que possuem boa capacidade<br>
de processamento e armazenamento."

	declare -g ABOUT_SNAP=$"
Programas Snap, assim como o Flatpak<br>
disponibiliza programas para todas as distribuições Linux.<br>
Tende a ser mais pesado e menos integrado ao sistema, mas<br>
se o programa que você procura está disponível apenas neste<br>
formato, utilize-o."

	declare -g ABOUT_MODE_SIMPLE=$"
Exibe apenas programas selecionados<br>
e oculta resultados que são úteis <br>
apenas a usuários avançados."

	declare -g TYPE_SEARCH=$"Procurar aplicativo"
	declare -g MODE_SIMPLE=$"Modo Simplificado"
	declare -g Nativos_text=$"Nativos"
	declare -g ProgressMessage=$"Aplicando - Aguarde"
	declare -g Inicio=$"Início"
	declare -g Configuracoes=$"Configurações"
	declare -g X_Sistema=$"X-Sistema"
	declare -g Imagem=$"Imagem"
	declare -g Video=$"Vídeo"
	declare -g Audio=$"Audio"
	declare -g Internet=$"Internet"
	declare -g Escritorio=$"Escritório"
	declare -g Graficos=$"Gráficos"
	declare -g Multimidia=$"Multimídia"
	declare -g Jogos=$"Jogos"
	declare -g Sistema=$"Sistema"
	declare -g Desenvolvimento=$"Desenvolvimento"
	declare -g Programas_Nativos=$"Programas Nativos"
	declare -g Programas_AUR=$"Programas AUR"
	declare -g Programas_Flatpak=$"Programas Flatpak"
	declare -g Programas_Snap=$"Programas Snap"
	export appstream_checkbox
	export aur_checkbox
	export flatpak_checkbox
	export snap_checkbox
}

function sh_refresh_installed_packages {
	#refrash installed packages
	#pacman -Qqe > ${TMP_FOLDER}/installed.txt
	#refrash installed packages AUR
	# pacman -Qm > ${TMP_FOLDER}/installedAur.txt
	:
}

function sh_include_script_pageshow {
	cat <<-EOF
		<script type="text/javascript">
			if (document.addEventListener) {
				window.addEventListener('pageshow', function (event) {
			        if (event.persisted || window.performance &&
			            window.performance.navigation.type == 2)
			        {
			            var url = window.location.toString;
			            var hostname = window.location.hostname;
			            var pathname = window.location.pathname;
			            var param = window.location.search;

			            if (pathname == '/config.sh.htm') {
			              disableBody();
			              //alert('Entrou ' + pathname);
			              window.location = pathname;
			            } else {
			              disableBody();
			              //alert('Entrou outro');
			              location.reload();
			            }
			        }
			    },
			   false);
			}
		</script>
	EOF
}

function sh_include_style {
	cat <<-EOF
		<style>
			div#box_progress_config {
			    position: fixed;
			    background-color: #000000aa;
			    width: 100%;
			    height: 100%;
			    z-index: 10;
			    display: none;
			}
			div#box_progress_config {
			    position: fixed;
			    background-color: #000000aa;
			    width: 100%;
			    height: 100%;
			    z-index: 10;
			    display: none;
			}
			div#box_progress_config_bar {
			    position: absolute;
			    font-family: "Lato", Ubuntu Condensed, sans-serif;
			    font-size: 13px;
			    color: #ccc;
			    top: 0;
			    left: 0;
			    right: 0;
			    bottom: 0;
			    margin: auto;
			    height: 300px;
			    width: 75%;
			    padding: 10px;
			    text-align: left;
			    background: #002240;
			    border-radius: 15px;
			}
			.loadingtxt {
				animation:extend 3s steps(3, end) infinite;
				display: inline-block;
				overflow: hidden;
				vertical-align: bottom;
				color: #fff;
				&:before { content:"..."; }
			}
			@keyframes extend { 0% { width:.25em; }
								   100% { width:1em; }}
			</style>
	EOF
}

function sh_category {
	declare -g SUB_CATEGORY

	case "$category" in
	3d) SUB_CATEGORY=$"Edição 3D e CAD" ;;
	audioplayer) SUB_CATEGORY=$"Reprodutores de áudio" ;;
	audioconvert) SUB_CATEGORY=$"Gravadores e conversores de áudio" ;;
	audioeditor) SUB_CATEGORY=$"Editores de áudio" ;;
	book) SUB_CATEGORY=$"Visualizadores de PDF, Epub, e-books e mais" ;;
	browser) SUB_CATEGORY=$"Navegadores" ;;
	calendar) SUB_CATEGORY=$"Agenda de tarefas e contatos" ;;
	cloud) SUB_CATEGORY=$"Armazenamento nas nuvens" ;;
	deveditor) SUB_CATEGORY=$"Editores de código e IDE" ;;
	devbd) SUB_CATEGORY=$"Banco de dados" ;;
	devgames) SUB_CATEGORY=$"Criadores de jogos" ;;
	devwebserver) SUB_CATEGORY=$"Servidores WEB" ;;
	download) SUB_CATEGORY=$"Download" ;;
	dvd) SUB_CATEGORY=$"Gravadores e copiadores de CD e DVD" ;;
	fonts) SUB_CATEGORY=$"Fontes (Tipografia)" ;;
	gamearcade) SUB_CATEGORY=$"Ação/Arcade" ;;
	gameboard) SUB_CATEGORY=$"Tabuleiro" ;;
	gamecard) SUB_CATEGORY=$"Cartas" ;;
	gameeducational) SUB_CATEGORY=$"Educacional" ;;
	gameemulator) SUB_CATEGORY=$"Emuladores" ;;
	gamemanager) SUB_CATEGORY=$"Gerenciadores de jogos" ;;
	gamepuzzle) SUB_CATEGORY=$"Puzzles" ;;
	gameretroarch) SUB_CATEGORY=$"Emulador Retroarch" ;;
	gamerpg) SUB_CATEGORY=$"RPG" ;;
	gamestrategy) SUB_CATEGORY=$"Estratégia" ;;
	gameutility) SUB_CATEGORY=$"Utilitários para jogos" ;;
	imageconvert) SUB_CATEGORY=$"Converter, redimensionar ou compactar imagens" ;;
	imageditor) SUB_CATEGORY=$"Editores de imagem e ferramentas de desenho" ;;
	imageplayer) SUB_CATEGORY=$"Visualizadores de imagem" ;;
	javajar) SUB_CATEGORY=$"Java JRE" ;;
	mail) SUB_CATEGORY=$"E-mail" ;;
	messages) SUB_CATEGORY=$"Mensageiros e Conferências" ;;
	network) SUB_CATEGORY=$"Ferramentas de rede" ;;
	news) SUB_CATEGORY=$"Notícias, Feeds e RSS" ;;
	office) SUB_CATEGORY=$"Suíte Office" ;;
	pdf) SUB_CATEGORY=$"Editores de PDF" ;;
	radio) SUB_CATEGORY=$"Rádio online" ;;
	remote) SUB_CATEGORY=$"Acesso Remoto, FTP, SSH, VNC, RDP..." ;;
	screenshot) SUB_CATEGORY=$"Captura de tela (Screenshot)" ;;
	storage) SUB_CATEGORY=$"Armazenamento e partições" ;;
	torrent) SUB_CATEGORY=$"Compartilhadores e Torrent" ;;
	videoplayer) SUB_CATEGORY=$"Reprodutores de vídeo" ;;
	videostream) SUB_CATEGORY=$"Vídeo online, IPTV, Youtube..." ;;
	videoeditor) SUB_CATEGORY=$"Editores e compactadores de vídeo" ;;
	virtualization) SUB_CATEGORY=$"Virtualização" ;;
	webcam) SUB_CATEGORY=$"Webcam, gravação de tela e transmissão de vídeo" ;;
	esac
}

function sh_include_div_he {
	if sh_lang_he; then
		echo '<div class="header-profile-back" style="margin-left: 15px;">'
	else
		echo '<div class="header-profile-back">'
	fi
}

# Carrega o tema e arquivos essenciais
function sh_header_sh_htm_main {
	cat <<-EOF
		<meta charset="utf-8">
		<script type="text/javascript" src="/usr/share/bigbashview/bcc/apps/big-store/materialize/js/jquery.js"></script>
		<script type="text/javascript" src="/usr/share/bigbashview/bcc/apps/big-store/materialize/js/materialize.js"></script>
		<script type="text/javascript" src="/usr/share/bigbashview/bcc/js/big.js"></script>
		<script type="text/javascript" src="js/autocomplete.js"></script>
		<script type="text/javascript" src="js/bigstore.js"></script>

		$(sh_include_script_pageshow)

		<link href="fontawesome/css/all.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" type="text/css" href="/usr/share/bigbashview/bcc/apps/big-store/materialize/css/materialize.css">
		<link rel="stylesheet" type="text/css" href="css/appstream.css">
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<title>Big-Store</title>
		<html>

		$(sh_include_style)

		<div id="box_progress_config">
		<div id="box_progress_config_bar">
		<svg viewBox="0 0 576 512" style="width: 17px; margin-right: 3px; margin-top: 2px;">
		<path fill="currentColor" d="M480 80C480 53.49 458.5 32 432 32h-288C117.5 32 96 53.49 96 80V384h384V80zM378.9 166.8l-88 112c-4.031 5.156-10 8.438-16.53 9.062C273.6 287.1 272.7 287.1 271.1 287.1c-5.719 0-11.21-2.019-15.58-5.769l-56-48C190.3 225.6 189.2 210.4 197.8 200.4c8.656-10.06 23.81-11.19 33.84-2.594l36.97 31.69l72.53-92.28c8.188-10.41 23.31-12.22 33.69-4.062C385.3 141.3 387.1 156.4 378.9 166.8zM528 288H512v112c0 8.836-7.164 16-16 16h-416C71.16 416 64 408.8 64 400V288H48C21.49 288 0 309.5 0 336v96C0 458.5 21.49 480 48 480h480c26.51 0 48-21.49 48-48v-96C576 309.5 554.5 288 528 288z"/>
		</svg>

		$ProgressMessage

		<span class="loadingtxt">...</span>
		</div></div>
		<div id="box_progress_config_simple"></div>

		$(sh_getbgcolor)

		<div id="box_progress"><div id="progress_loading">
		<div class="lds-ring"><div></div><div></div><div></div><div></div></div>
		</div></div>
		<div class="dark-light">
		<svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
		<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
		</svg>
		</div>
		<div class="app">
		<div class="header">
	EOF

	# Save search query
	search="${search//+/ }"
	echo "$search" >"${TMP_FOLDER}/query.txt"

	if [[ -n "$search" ]]; then
		if [[ -n "$resultFilter_checkbox" ]]; then
			echo "" >"$HOME_FOLDER/resultFilter"
		else
			[[ -e "$HOME_FOLDER/resultFilter" ]] && rm -f "$HOME_FOLDER/resultFilter"
		fi
	else
		if [ -e "$HOME_FOLDER/resultFilter" ]; then
			resultFilter_checkbox="checked"
		fi
	fi

	cat <<-EOF
		<div class="search-bar">
		<form action="index.sh.htm" method="post" id="formsearch" onsubmit="disableBody();">
		<input type="text" name="search" id="search" value="$search" class="custom-search-input validate bigsearch autocomplete" placeholder="$TYPE_SEARCH..." autofocus>
		<button class="custom-search-botton" type="submit">← Enter </button>
		</div>
		<div class="header-profile">
		<div class="tooltipped" data-position="bottom" data-tooltip="$ABOUT_MODE_SIMPLE">
		<div class="switch">
		<label><input type="checkbox" class="switch" name="resultFilter_checkbox" value="checked" $resultFilter_checkbox>
		<span class="lever"></span>
		$MODE_SIMPLE
		</label>
		</div></div>
		</form>
		</div></div>
	EOF

	#APPSTREAM
	if [[ -e "$HOME_FOLDER/hide_appstream" ]]; then
		appstream_checkbox=""
		if [[ "$appstream_change" = "y" ]]; then
			rm -f "$HOME_FOLDER/hide_appstream"
			appstream_checkbox="checked"
		fi
	else
		appstream_checkbox="checked"
		if [[ "$appstream_change" = "y" ]]; then
			echo "" >"$HOME_FOLDER/hide_appstream"
			appstream_checkbox=""
		fi
	fi

	#AUR
	if [[ -e "${HOME_FOLDER}/hide_aur" ]]; then
		aur_checkbox=""
		if [ "$aur_change" = "y" ]; then
			rm -f "$HOME_FOLDER/hide_aur"
			aur_checkbox="checked"
		fi
	else
		aur_checkbox="checked"
		if [ "$aur_change" = "y" ]; then
			echo "" >"${HOME_FOLDER}/hide_aur"
			aur_checkbox=""
		fi
	fi

	#FLATPAK
	if [[ -e '/usr/lib/libpamac-flatpak.so' ]]; then
		if [[ -e "$HOME_FOLDER/hide_flatpak" ]]; then
			flatpak_checkbox=""
			if [[ "$flatpak_change" = "y" ]]; then
				rm -f "$HOME_FOLDER/hide_flatpak"
				flatpak_checkbox="checked"
			fi
		else
			flatpak_checkbox="checked"
			if [[ "$flatpak_change" = "y" ]]; then
				echo "" >"$HOME_FOLDER/hide_flatpak"
				flatpak_checkbox=""
			fi
		fi
	else
		DISABLE_FLATPAK="y"
	fi

	#SNAP
	if [[ -e "/usr/lib/libpamac-snap.so" ]]; then
		if [[ -e "$HOME_FOLDER/hide_snap" ]]; then
			snap_checkbox=""
			if [[ "$snap_change" = "y" ]]; then
				rm -f "$HOME_FOLDER/hide_snap"
				snap_checkbox="checked"
			fi
		else
			snap_checkbox="checked"
			if [[ "$snap_change" = "y" ]]; then
				echo "" >"$HOME_FOLDER/hide_snap"
				snap_checkbox=""
			fi
		fi
	else
		DISABLE_SNAP="y"
	fi

	cat <<-EOF
		$(sh_div_lang)
		<div class="left-side">
		<div class="side-wrapper">
		<div class="side-menu">
		<a href="index.sh.htm">
		<svg viewBox="0 0 512 512">
		<g xmlns="http://www.w3.org/2000/svg" fill="currentColor">
		<path d="M0 0h128v128H0zm0 0M192 0h128v128H192zm0 0M384 0h128v128H384zm0 0M0 192h128v128H0zm0 0" data-original="#bfc9d1" />
		</g>
		<path xmlns="http://www.w3.org/2000/svg" d="M192 192h128v128H192zm0 0" fill="currentColor" data-original="#82b1ff" />
		<path xmlns="http://www.w3.org/2000/svg" d="M384 192h128v128H384zm0 0M0 384h128v128H0zm0 0M192 384h128v128H192zm0 0M384 384h128v128H384zm0 0" fill="currentColor" data-original="#bfc9d1" />
		</svg>
		<span>
		$Inicio
		</span>
		</a>
		<a href="config.sh.htm">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 fa-3x"><path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z" class=""></path></svg>
		<span>
		$Configuracoes
		</span>
		</a>
		</div></div>
		<div class="side-wrapper">
		<div class="side-menu">
	EOF

	### Categorias ###

	if sh_get_XIVAStudio; then
		cat <<-EOF
			<div class="side-title">
			XIVA Store
			</div>
			</a>
			<a href="index.sh.htm?#xystem">
			<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="box" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline--fa fa-box fa-w-16 fa-3x">
			<path fill="currentColor" d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z" class="">
			</path></svg>
			<span>
			$X_Sistema
			</span>
			</a>
			<a href="index.sh.htm?#image"><svg viewBox="0 0 512 512" fill="currentColor">
			<path d="M499.377 46.402c-8.014-8.006-18.662-12.485-29.985-12.613a41.13 41.13 0 00-.496-.003c-11.142 0-21.698 4.229-29.771 11.945L198.872 275.458c25.716 6.555 47.683 23.057 62.044 47.196a113.544 113.544 0 0110.453 23.179L500.06 106.661C507.759 98.604 512 88.031 512 76.89c0-11.507-4.478-22.33-12.623-30.488zM176.588 302.344a86.035 86.035 0 00-3.626-.076c-20.273 0-40.381 7.05-56.784 18.851-19.772 14.225-27.656 34.656-42.174 53.27C55.8 397.728 27.795 409.14 0 416.923c16.187 42.781 76.32 60.297 115.752 61.24 1.416.034 2.839.051 4.273.051 44.646 0 97.233-16.594 118.755-60.522 23.628-48.224-5.496-112.975-62.192-115.348z" />
			</svg>
			<span>
			$Imagem
			</span>
			</a>
			<a href="index.sh.htm?#video">
			<svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
			<path d="M1.75 1a.748.748 0 0 0-.75.75v13.5c0 .415.335.75.75.75h12.5c.416 0 .75-.335.75-.75V1.75a.748.748 0 0 0-.75-.75zM2 2h1v1H2zm2.5 0h7c.277 0 .5.223.5.5v5c0 .277-.223.5-.5.5h-7a.499.499 0 0 1-.5-.5v-5c0-.277.223-.5.5-.5zM13 2h1v1h-1zM2 4h1v1H2zm11 0h1v1h-1zM2 6h1v1H2zm11 0h1v1h-1zM2 8h1v1H2zm11 0h1v1h-1zM4.5 9h7c.277 0 .5.223.5.5v5c0 .277-.223.5-.5.5h-7a.499.499 0 0 1-.5-.5v-5c0-.277.223-.5.5-.5zM2 10h1v1H2zm11 0h1v1h-1zM2 12h1v1H2zm11 0h1v1h-1zM2 14h1v1H2zm11 0h1v1h-1z"/>
			</svg>
			<span>
			$Video
			</span>
			</a>
			<a href="index.sh.htm?#audio">
			<svg viewBox="0 0 512 512" fill="currentColor">
			<path d="M470.38 1.51L150.41 96A32 32 0 0 0 128 126.51v261.41A139 139 0 0 0 96 384c-53 0-96 28.66-96 64s43 64 96 64 96-28.66 96-64V214.32l256-75v184.61a138.4 138.4 0 0 0-32-3.93c-53 0-96 28.66-96 64s43 64 96 64 96-28.65 96-64V32a32 32 0 0 0-41.62-30.49z" />
			</svg>
			<span>
			$Audio
			</span>
			</a></div></div>
			<div class="side-wrapper">
			<div class="side-menu">
			<div class="side-title">
			Big Store
			</div>
		EOF
	fi

	cat <<-EOF
		<a href="index.sh.htm?#internet">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="globe-americas" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-globe-americas fa-w-16 fa-3x">
		<path fill="currentColor" d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm82.29 357.6c-3.9 3.88-7.99 7.95-11.31 11.28-2.99 3-5.1 6.7-6.17 10.71-1.51 5.66-2.73 11.38-4.77 16.87l-17.39 46.85c-13.76 3-28 4.69-42.65 4.69v-27.38c1.69-12.62-7.64-36.26-22.63-51.25-6-6-9.37-14.14-9.37-22.63v-32.01c0-11.64-6.27-22.34-16.46-27.97-14.37-7.95-34.81-19.06-48.81-26.11-11.48-5.78-22.1-13.14-31.65-21.75l-.8-.72a114.792 114.792 0 0 1-18.06-20.74c-9.38-13.77-24.66-36.42-34.59-51.14 20.47-45.5 57.36-82.04 103.2-101.89l24.01 12.01C203.48 89.74 216 82.01 216 70.11v-11.3c7.99-1.29 16.12-2.11 24.39-2.42l28.3 28.3c6.25 6.25 6.25 16.38 0 22.63L264 112l-10.34 10.34c-3.12 3.12-3.12 8.19 0 11.31l4.69 4.69c3.12 3.12 3.12 8.19 0 11.31l-8 8a8.008 8.008 0 0 1-5.66 2.34h-8.99c-2.08 0-4.08.81-5.58 2.27l-9.92 9.65a8.008 8.008 0 0 0-1.58 9.31l15.59 31.19c2.66 5.32-1.21 11.58-7.15 11.58h-5.64c-1.93 0-3.79-.7-5.24-1.96l-9.28-8.06a16.017 16.017 0 0 0-15.55-3.1l-31.17 10.39a11.95 11.95 0 0 0-8.17 11.34c0 4.53 2.56 8.66 6.61 10.69l11.08 5.54c9.41 4.71 19.79 7.16 30.31 7.16s22.59 27.29 32 32h66.75c8.49 0 16.62 3.37 22.63 9.37l13.69 13.69a30.503 30.503 0 0 1 8.93 21.57 46.536 46.536 0 0 1-13.72 32.98zM417 274.25c-5.79-1.45-10.84-5-14.15-9.97l-17.98-26.97a23.97 23.97 0 0 1 0-26.62l19.59-29.38c2.32-3.47 5.5-6.29 9.24-8.15l12.98-6.49C440.2 193.59 448 223.87 448 256c0 8.67-.74 17.16-1.82 25.54L417 274.25z" class="">
		</path>
		</svg>
		<span>
		$Internet
		</span>
		</a>
		<a href="index.sh.htm?#office">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="briefcase" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-briefcase fa-w-16 fa-3x">
		<path fill="currentColor" d="M320 336c0 8.84-7.16 16-16 16h-96c-8.84 0-16-7.16-16-16v-48H0v144c0 25.6 22.4 48 48 48h416c25.6 0 48-22.4 48-48V288H320v48zm144-208h-80V80c0-25.6-22.4-48-48-48H176c-25.6 0-48 22.4-48 48v48H48c-25.6 0-48 22.4-48 48v80h512v-80c0-25.6-22.4-48-48-48zm-144 0H192V96h128v32z" class="">
		</path>
		</svg>
		<span>
		$Escritorio
		</span>
		</a>
		<a href="index.sh.htm?#graphics"><svg viewBox="0 0 512 512" fill="currentColor">
		<path d="M499.377 46.402c-8.014-8.006-18.662-12.485-29.985-12.613a41.13 41.13 0 00-.496-.003c-11.142 0-21.698 4.229-29.771 11.945L198.872 275.458c25.716 6.555 47.683 23.057 62.044 47.196a113.544 113.544 0 0110.453 23.179L500.06 106.661C507.759 98.604 512 88.031 512 76.89c0-11.507-4.478-22.33-12.623-30.488zM176.588 302.344a86.035 86.035 0 00-3.626-.076c-20.273 0-40.381 7.05-56.784 18.851-19.772 14.225-27.656 34.656-42.174 53.27C55.8 397.728 27.795 409.14 0 416.923c16.187 42.781 76.32 60.297 115.752 61.24 1.416.034 2.839.051 4.273.051 44.646 0 97.233-16.594 118.755-60.522 23.628-48.224-5.496-112.975-62.192-115.348z" />
		</svg>
		<span>
		$Graficos
		</span>
		</a>
		<a href="index.sh.htm?#multimedia">
		<svg viewBox="0 0 512 512" fill="currentColor">
		<path d="M470.38 1.51L150.41 96A32 32 0 0 0 128 126.51v261.41A139 139 0 0 0 96 384c-53 0-96 28.66-96 64s43 64 96 64 96-28.66 96-64V214.32l256-75v184.61a138.4 138.4 0 0 0-32-3.93c-53 0-96 28.66-96 64s43 64 96 64 96-28.65 96-64V32a32 32 0 0 0-41.62-30.49z" />
		</svg>
		<span>
		$Multimidia
		</span>
		</a>
		<a href="index.sh.htm?#games">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="gamepad" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-gamepad fa-w-20 fa-3x">
		<path fill="currentColor" d="M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z" class="">
		</path></svg>
		<span>
		$Jogos
		</span>
		</a>
		<a href="index.sh.htm?#system"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="box" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline--fa fa-box fa-w-16 fa-3x"><path fill="currentColor" d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z" class=""></path></svg>
		<span>
		$Sistema
		</span>
		</a>
		<a href="index.sh.htm?#dev">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="flask" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-flask fa-w-14 fa-3x">
		<path fill="currentColor" d="M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z" class="">
		</path></svg>
		<span>
		$Desenvolvimento
		</span>
		</a></div></div></div>
		<div class="main-container">
		<div class="main-header">

		$(sh_include_div_he)

		<a href="#" onclick="history.back()">
		<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-info-circle fa-w-16 fa-3x">
		<path fill="currentColor" d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z" class=""></path></svg>
		</a>
		</div>
	EOF

	if sh_lang_he; then
		cat <<-EOF
			<style>
				.header-menu                          { width: calc(100% - -220px) !important; margin-left: 0px !important; }
				@media screen and (max-width: 1055px) { .header-menu { width: calc(100% - -70px) !important; }}
			</style>
			<div class="header-menu" style="flex-direction: row-reverse;">
		EOF
	else
		echo '<div class="header-menu">'
	fi

	cat <<-EOF
		<div onchange="disableBody();javascript:location.href='index.sh.htm?appstream_change=y&search=$search'" class="tooltipped" data-position="bottom" data-tooltip="$ABOUT_APPSTREAM">
		<div class="switch">
		<label>
		<input class="switch" type="checkbox" $appstream_checkbox>
		<span class="lever">
		</span>
		$Nativos_text
		<div id="appstream_number">
		</div></label></div></div>

		<div onchange="disableBody();javascript:location.href='index.sh.htm?aur_change=y&search=$search'" class="tooltipped" data-position="bottom" data-tooltip="$ABOUT_AUR">
		<div class="switch">
		<label>
		<input class="switch" type="checkbox" $aur_checkbox>
		<span class="lever">
		</span>
		Aur
		<div id="aur_number">
		</div></label></div></div>
	EOF

	if [[ "$DISABLE_FLATPAK" != "y" ]]; then
		cat <<-EOF
			<div onchange="disableBody();javascript:location.href='index.sh.htm?flatpak_change=y&search=$search'" class="tooltipped" data-position="bottom" data-tooltip="$ABOUT_FLATPAK">
			<div class="switch">
			<label>
			<input class="switch" type="checkbox" $flatpak_checkbox>
			<span class="lever">
			</span>
			Flatpak
			<div id="flatpak_number">
			</div></label></div></div>
		EOF
	fi

	if [[ "$DISABLE_SNAP" != "y" ]]; then
		cat <<-EOF
			<div onchange="disableBody();javascript:location.href='index.sh.htm?snap_change=y&search=$search'" class="tooltipped" data-position="bottom" data-tooltip="$ABOUT_SNAP">
			<div class="switch">
			<label>
			<input class="switch" type="checkbox" $snap_checkbox>
			<span class="lever">
			</span>
			Snap
			<div id="snap_number">
			</div></label></div></div>
		EOF
	fi

	cat <<-EOF
		</div>
		</div>
		<div class="content-wrapper">
	EOF

	sh_category

	if [[ -n "$SUB_CATEGORY" ]]; then
		cat <<-EOF
			<div class="subcategory_title_index">
			$SUB_CATEGORY
			</div>
		EOF
	fi

	# Verifica que alguma palavra foi digitada na busca
	if [ "${#search}" -ge "2" ]; then
		#		echo '<div class="row center" id="flex">'
		#		if [ "$appstream_checkbox" = "checked" ]; then
		APPSTREAM_CATEGORY "${search,,}"
		#			[[ -e "${TMP_FOLDER}/appstream_number.html" ]] && rm -f "${TMP_FOLDER}/appstream_number.html"
		#			cat <<-EOF
		#				<div id="box_appstream">
		#				<div id="title_appstream">
		#				<div id="button_appstream" class="tooltipped" data-position="right" data-tooltip="$ABOUT_APPSTREAM">
		#				<div style="display: inline-flex; margin-top: -8px; margin-right: 10px;">
		#				<svg role="img" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg" style="width:17px;margin-left:5px;">
		#				<path fill="var(--text-a-color)" d="M50.73 58.53C58.86 42.27 75.48 32 93.67 32H208V160H0L50.73 58.53zM240 160V32H354.3C372.5 32 389.1 42.27 397.3 58.53L448 160H240zM448 416C448 451.3 419.3 480 384 480H64C28.65 480 0 451.3 0 416V192H448V416z"/>
		#				</svg>
		#				</div><div style="margin-right: 5px;">
		#				$Programas_Nativos
		#				</div></div></div>
		#				<div id="content_appstream">
		#			EOF
		#
		#			# sync mode
		#			pacman -Qu | awk '{print $1}' > ${TMP_FOLDER}/upgradeable.txt
		#
		#			if [[ -n "$resultFilter_checkbox" ]]; then
		##				./search_appstream_pamac_simple.py "${search,,}"
		#				./search_appstream_pamac.py "${search,,}"
		#			else
		##				./search_appstream_pamac.py "${search,,}"
		#				./category_appstream_pamac.py "${search,,}"
		#			fi
		#			echo '</div></div>'
		#		fi

		if [[ "$aur_checkbox" = "checked" ]]; then
			AUR_CATEGORY "${search,,}"
			#			[[ -e ${TMP_FOLDER}/aur_number.html ]] && rm -f ${TMP_FOLDER}/aur_number.html
			#			cat <<-EOF
			#				<div id="box_aur">
			#				<div id="title_aur">
			#				<div id="button_aur" class="tooltipped" data-position="right" data-tooltip="$ABOUT_AUR">
			#				<div style="display: inline-flex; margin-top: -8px; margin-right: 10px;">
			#				<svg role="img" viewBox="0 0 640 512" xmlns="http://www.w3.org/2000/svg" style="width:20px;margin-left: 5px;">
			#				<path fill="var(--text-a-color)" d="M75.23 33.4L320 63.1L564.8 33.4C571.5 32.56 578 36.06 581.1 42.12L622.8 125.5C631.7 143.4 622.2 165.1 602.9 170.6L439.6 217.3C425.7 221.2 410.8 215.4 403.4 202.1L320 63.1L236.6 202.1C229.2 215.4 214.3 221.2 200.4 217.3L37.07 170.6C17.81 165.1 8.283 143.4 17.24 125.5L58.94 42.12C61.97 36.06 68.5 32.56 75.23 33.4H75.23zM321.1 128L375.9 219.4C390.8 244.2 420.5 255.1 448.4 248L576 211.6V378.5C576 400.5 561 419.7 539.6 425.1L335.5 476.1C325.3 478.7 314.7 478.7 304.5 476.1L100.4 425.1C78.99 419.7 64 400.5 64 378.5V211.6L191.6 248C219.5 255.1 249.2 244.2 264.1 219.4L318.9 128H321.1z"/>
			#				</svg></div>
			#				<div style="margin-right: 5px;">
			#				$Programas_AUR
			#				</div></div>
			#				</div>
			#				<div id="content_aur">
			#				<script>document.getElementById("aur_icon_loading").innerHTML = "<div class=progress><div class=indeterminate></div></div>";</script>
			#			EOF
			#
			#			# Search
			#			[[ -e ${TMP_FOLDER}/aur.html ]] && rm -f ${TMP_FOLDER}/aur.html
			#			resultFilter_checkbox="$resultFilter_checkbox" ./search_aur.sh "${search,,}" &
			#
			#		cat <<-EOF
			#			<script>fileReplaceDiv(true, '#content_aur', '${TMP_FOLDER}/aur.html');</script>
			#			<script>fileReplaceDiv(true, '#aur_number', '${TMP_FOLDER}/aur_number.html');</script>
			#			</div>
			#			</div>
			#		EOF
		fi

		if [[ "$flatpak_checkbox" = "checked" ]]; then
			FLATPAK_CATEGORY "${search,,}"
			#			[[ -e ${TMP_FOLDER}/flatpak_number.html ]] && rm -f ${TMP_FOLDER}/flatpak_number.html
			#			cat <<-EOF
			#				<div id="box_flatpak">
			#				<div id="title_flatpak">
			#				<div id="button_flatpak" class="tooltipped" data-position="right" data-tooltip="$ABOUT_FLATPAK">
			#				<div style="display: inline-flex; margin-top: -8px; margin-right: 10px;">
			#				<svg role="img" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" style="width:20px;margin-left: 5px;">
			#				<path fill="var(--text-a-color)" d="m 200,5.9523902 c -8.98514,0 -17.97169,2.3280645 -26.03677,6.9844298 L 51.016633,83.920269 C 34.886486,93.233022 24.979868,110.38745 24.979868,129.01293 v 141.97046 c 0,18.62546 9.906618,35.77989 26.036765,45.09264 l 122.946597,70.98701 c 16.13013,9.31276 35.9434,9.31276 52.07354,0 l 122.94659,-70.98701 c 16.13016,-9.31275 26.03677,-26.46718 26.03677,-45.09264 V 129.01293 c 0,-18.62548 -9.90661,-35.779908 -26.03677,-45.092661 L 226.03677,12.93682 C 217.9717,8.2804547 208.98514,5.9523902 200,5.9523902 Z m 0,38.1331378 c 2.41371,0 4.82858,0.621233 6.97729,1.861803 l 122.94663,70.983449 c 2.14873,1.24057 3.89441,3.02162 5.10127,5.11195 L 200,199.99993 v 155.91086 c -2.41371,0 -4.82859,-0.62123 -6.97731,-1.86182 L 70.07608,283.06553 c -4.297468,-2.48115 -6.977319,-7.11987 -6.977319,-12.08214 V 129.01293 c 0,-2.48114 0.669184,-4.87986 1.876048,-6.9702 L 200,199.99993 Z"/>
			#				</svg>
			#				</div><div style="margin-right: 5px;">
			#				$Programas_Flatpak
			#				</div></div></div>
			#				<div id="content_flatpak">
			#			EOF
			#
			#			[[ -e ${TMP_FOLDER}/flatpak.html ]] && rm -f ${TMP_FOLDER}/flatpak.html
			#			resultFilter_checkbox="$resultFilter_checkbox" ./search_flatpak.sh "${search,,}"  > /dev/null 2>&1 &
			##			resultFilter_checkbox="$resultFilter_checkbox" sh_search_flatpak "${search,,}" &
			#
			#			cat <<-EOF
			#				<script>fileReplaceDiv(true, '#content_flatpak', '${TMP_FOLDER}/flatpak.html');</script>
			#				<script>fileReplaceDiv(true, '#flatpak_number', '${TMP_FOLDER}/flatpak_number.html');</script>
			#				</div>
			#				</div>
			#			EOF
		fi

		if [[ "$snap_checkbox" = "checked" ]]; then
			SNAP_CATEGORY "${search,,}"
#			[[ -e "$TMP_FOLDER/snap_number.html" ]] && rm -f "$TMP_FOLDER/snap_number.html"
#			cat <<-EOF
#				<div id="box_snap">
#				<div id="title_snap">
#				<div id="button_flatpak" class="tooltipped" data-position="right" data-tooltip="$ABOUT_SNAP">
#				<div style="display: inline-flex; margin-top: -8px; margin-right: 10px;">
#				<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width:20px;margin-left: 5px;">
#				<path fill="var(--text-a-color)" d="M13.804 13.367V5.69l5.292 2.362-5.292 5.315zM3.701 23.514l6.49-12.22 2.847 2.843L3.7 23.514zM0 .486l13.355 4.848v8.484L0 .486zM21.803 5.334H14.11L24 9.748z"/>
#				</svg>
#				</div><div style="margin-right: 5px;">
#				$Programas_Snap
#				</div></div></div>
#				<div id="content_snap">
#			EOF
#			[[ -e "$TMP_FOLDER/snap.html" ]] && rm -f "$TMP_FOLDER/snap.html"
#			sh_search_snap "${search,,}" &
#			cat <<-EOF
#				<script>fileReplaceDiv(true, '#content_snap', '${TMP_FOLDER}/snap.html');</script>
#				<script>fileReplaceDiv(true, '#snap_number',  '${TMP_FOLDER}/snap_number.html');</script>
#				</div></div>
#			EOF
		fi
	fi
}

#sh_debug
sh_config
sh_refresh_installed_packages
if [[ $# -eq 0 ]]; then
	sh_header_sh_htm_main
else
	eval "$@"
fi
